#define _CRT_SECURE_NO_WARNINGS 1
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
void EncryptFile(FILE* sfp, FILE* dfp, char pwd)//加密函数，算法和之前类似 
{
	char ch;
	if (sfp == 0 || dfp == 0)
	{
		printf("错误!\n");
		return;
	}
	while ((ch = fgetc(sfp)) != EOF)
	{
		if ((ch >= 'a') && (ch <= 'z'))
		{
			ch = ((ch - 'a' + 3 + 26) % 26 + 'a');
		}
		if ((ch >= 'A') && (ch <= 'Z'))
		{
			ch = ((ch - 'A' + 3 + 26) % 26 + 'A');
		}
		fputc(ch, dfp);
	}
}
void DecryptFile(FILE* sfp, FILE* dfp, char pwd)//解密函数，算法与加密相反 
{
	char ch;
	while ((ch = fgetc(sfp)) != EOF)
	{
		if ((ch >= 'a') && (ch <= 'z'))
		{
			ch = (ch - 'a' + 26 - 3) % 26 + 'a';
		}
		if ((ch >= 'A') && (ch <= 'Z'))
		{
			ch = (ch - 'A' + 26 - 3) % 26 + 'A';
		}
		fputc(ch, dfp);
	}
}
void OutputFile(FILE* fp)//输出函数，输出文件内容 
{
	char ch;
	while ((ch = fgetc(fp)) != EOF)
		putchar(ch);
}
int main()
{
	int a;
	printf("输入 1 为文件加密，输入 2 为文件解密，输入其他字符退出程序\n");
	scanf("%d", &a);
	if (a == 1) {
		char sfilename[20];//输入文件名
		char dfilename[20];//输入保存的文件名
		char pwd;//用来保存加密字符
		FILE* sfp, * dfp;
		printf("\n输入你要加密的文件名:\n");
		getchar();
		gets(sfilename);//得到文件名
		printf("输入加密后你的文件名:\n");
		gets(dfilename);//得到你要的文件名
		printf("输入任意字符结束\n");
		//scanf("%c", &pwd);//得到字符
		//pwd = getchar();//得到加密字符
		//printf("*\n");//*来表示输入的加密字符
		scanf("%d", &a);
		if ((sfp = fopen(sfilename, "r")) == 0)//以只读方式打开要加密的文件
		{
			printf("不能打开文件 :%s\n", sfilename);
			exit(0);
		}
		printf("\n要加密的文件文本为:\n");
		OutputFile(sfp);//输出要加密的文件
		if ((dfp = fopen(dfilename, "w+")) == 0)//建立加密后的文件
		{
			printf("不能打开或者创建文件:%s\n", dfilename);
			exit(0);
		}
		//文件加密
		fseek(sfp, 0L, SEEK_SET);
		EncryptFile(sfp, dfp, pwd);
		printf("\n文件加密成功!\n");
		//输出加密后的文件
		printf("\n加密后 文件里的文本为:");
		fseek(dfp, 0L, SEEK_SET);
		OutputFile(dfp);
		fclose(sfp);
		fclose(dfp);
		getchar();
	}
	else if (a == 2)
	{
		char sfilename[20];//输入要解密的文件名
		char dfilename[20];//输入解密后保存的文件名
		char pwd;//用来保存解密字符
		FILE* sfp, * dfp;
		printf("\n输入你要解密的文件名:\n");
		getchar();
		gets(sfilename);//得到要解密的文件名
		printf("输入加密后你的文件名:\n");
		gets(dfilename);//得到解密后你要的文件名
		printf("输入任意字符结束\n");
		//scanf("%c", &pwd);//得到解密字符
		//pwd = getchar();//得到解密字符
		scanf("%d", &a);
		if ((sfp = fopen(sfilename, "r")) == 0)//以只读方式打开要解密的文件
		{
			printf("不能打开文件:%s\n", sfilename);
			exit(0);
		}
		printf("\n要解密的文件文本为:\n");
		OutputFile(sfp);//输出要解密的文件
		if ((dfp = fopen(dfilename, "w+")) == 0)//建立解密后的文件
		{
			printf("不能打开或者创建文件 :%s\n", dfilename);
			exit(0);
		}
		fseek(sfp, 0L, SEEK_SET);
		DecryptFile(sfp, dfp, pwd);
		printf("\n文件解密成功\n");
		//输出解密后的文件
		printf("\n解密后 文件里的文本为:");
		fseek(dfp, 0L, SEEK_SET);
		OutputFile(dfp);
		fclose(sfp);
		fclose(dfp);
		getchar();
		return 0;
	}
	return 0;
}
